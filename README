## INSTALLER KUBERNETES

### 1Ô∏è‚É£ Pr√©-requis : Docker
```shell
docker --version
```
### 2Ô∏è‚É£ Installer kubectl (outil pour parler √† Kubernetes)
```shell
curl -LO https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl
chmod +x kubectl
sudo mv kubectl /usr/local/bin/
```
Test :
```shell
kubectl version --client
```
### 3Ô∏è‚É£ Installer KIND
```shell
curl -Lo kind https://kind.sigs.k8s.io/dl/v0.22.0/kind-linux-amd64
chmod +x kind
sudo mv kind /usr/local/bin/
```
### 4Ô∏è‚É£ Cr√©er Kubernetes (1 commande üòé)
```shell
kind create cluster
```
### 5Ô∏è‚É£ V√©rifier
```shell
kubectl get nodes
```
Tu dois voir :
kind-control-plane   Ready

## LANCER LES PODS

### Build les images Docker 
```shell
docker build -t gateway:dev ./services/gateway
docker build -t message-service:dev ./services/message
docker build -t presence-service:dev ./services/presence
docker build -t user-service:dev ./services/user
docker build -t notification-service:dev ./services/notification
docker build -t moderation-service:dev ./services/moderation
```
### Charger les images builder
```shell
kind load docker-image gateway:dev
kind load docker-image message-service:dev
kind load docker-image presence-service:dev
kind load docker-image user-service:dev
kind load docker-image notification-service:dev
kind load docker-image moderation-service:dev
```
### Forcer un red√©marrage des pods
```shell
kubectl rollout restart deployment gateway
kubectl rollout restart deployment message-service
kubectl rollout restart deployment presence-service
kubectl rollout restart deployment user-service
kubectl rollout restart deployment notification-service
kubectl rollout restart deployment moderation-service
```
### V√©rifier l‚Äô√©tat des Pods
```shell
kubectl get pods
```
## RELOAD AUTOMATIQUE DES CONTAINER
### Installer Skaffold
```shell
curl -Lo skaffold https://storage.googleapis.com/skaffold/releases/latest/skaffold-linux-amd64
chmod +x skaffold
sudo mv skaffold /usr/local/bin
```
V√©rifie :
```shell
skaffold version
```
### Lancer Skaffold
```shell
skaffold dev
```

## NOTE: CASSANDRA
Cassandra a √©t√© retir√© de la configuration Skaffold car il demande trop de ressources pour KIND.
Pour d√©ployer Cassandra manuellement :
```shell
kubectl apply -f k8s/cassandra.yaml
```
Tous les autres services fonctionnent correctement ‚úÖ
## SUPPRIMER ET RECR√âER LES PODS

### Supprimer tous les pods
```shell
kubectl delete pods --all
```

### Supprimer tous les deployments
```shell
kubectl delete deployments --all
```

### Recr√©er tous les pods (via deployments)
```shell
kubectl apply -f k8s/
```

### Variante : Restart tous les deployments
```shell
kubectl rollout restart deployment --all
```
## AUTRE COMMANDES

### Si un Pod n‚Äôest PAS Running
```shell
kubectl describe pod <nom-du-pod>
```
### Voir les logs
```shell
kubectl logs <nom-du-pod>
```
### V√©rifier les Services
```shell
kubectl get svc
```